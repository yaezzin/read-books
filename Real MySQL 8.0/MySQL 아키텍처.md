# MySQL 아키텍처

## 메모리 할당 및 사용 구조

<img width="400" height="203" alt="스크린샷 2025-10-02 오후 12 24 54" src="https://github.com/user-attachments/assets/daacf983-a06c-47f0-8f3d-4bec30a82c40" />

#### 1 ) 글로벌 메모리 영역

* MySQL 서버가 시작되면서 운영체제로부터 할당됨
* MySQL의 시스템 변수로 설정해 둔 만큼 운영체제로부터 메모리를 할당 받음
  * 운영체제의 종류에 따라 요청된 메모리 공간을 100% 할당해줄 수도 있고, 그 공간만큼 예약해두고 필요할 때 조금씩 할당해주는 경우도 있음 
* 클라이언트 스레드의 수와 무관하게 하나의 메모리공간만 할당되고, 모든 스레드에 의해 공유됨

#### 2 ) 로컬 메모리 영역 (=세션 메모리 영역)

* MySQL 서버상에 존재하는 클라이언트 스레드가 쿼리를 처리하는데 사용하는 메모리 영역
* 각 클라이언트 스레드별로 독립적으로 할당되며, 절대 공유되어 사용되지 않음
 * 소트버퍼, 조인버퍼 ➡️ 쿼리를 실행하는 순간에만 공간 할당
 * 커넥션 버퍼, 결과버퍼 ➡️ 커넥션이 열려있는 동안 계속 할당된 상태로 유지 

## 쿼리 실행 구조

<img width="429" height="283" alt="스크린샷 2025-10-02 오후 4 06 21" src="https://github.com/user-attachments/assets/363da393-683b-4b94-b67c-95987dc8e067" />

#### 1) 쿼리 파서

* 사용자 요청으로 들어온 문장을 MySQL이 인식할 수 있는 최소단위의 어휘/기호로 분리해 트리 형태의 구조를 만들어내는 작업
* 쿼리 문장의 기본 문법 오류는 이 과정에서 발견되고, 사용자에게 오류 메세지를 전달하게 됨

#### 2) 전처리기

* 파서 과정에서 만들어진 파서 트리를 기반으로 쿼리 문장에 구조적인 문제점이 있는지 확인
* 각 토큰을 테이블 이름이나 컬럼 이름 또는 내장함수와 같은 개체를 매핑해 해당 객체의 존재여부와 객체의 접근 권한등을 확인함
  * 이 단계에서 실제 존재하지 않거나 권한상 사용할 수 없는 개체의 토큰이 걸러짐

#### 3) 옵티마이저

* 사용자의 요청으로 들어온 쿼리 문장을 가장 저렴한 비용으로 가장 빠르게 처리할지를 결정하는 역할

#### 4) 실행엔진

* 만들어진 계획대로 각 핸들러에게 요청해서 받은 결과를 또 다른 핸들러 요청의 입력으로 연결하는 역할을 수행

#### 5) 핸들러 (스토리지 엔진)

* 실행엔진의 요청에 따라 데이터를 디스크로 저장하고, 디스크로부터 읽어 오는 역할을 담당
* MyISAM 테이블을 조작하는 경우에는 핸들러가 MyISAM 스토리지 엔진이 되고, InnoDB 테이블을 조작하는 경우에는 핸들러가 InnoDB 스토리지 엔진이 됨


## 쿼리 캐시

* 쿼리 캐시는 SQL의 실행 결과를 메모리에 캐시하고 동일 SQL 쿼리가 실행되면 테이블을 읽지 않고 즉시 결과를 반환함
* 쿼리 캐시는 테이블의 데이터가 변경되면 캐시에 저장된 결과중에서 변경된 테이블과 관련된 것들은 모두 삭제해야했기 때문에 동시 처리 성능 저하를 유발했음
  ➡️ 따라서 8.0으로 올라오면서 쿼리 캐시는 MySQL 서버의 기능에서 완전히 제거되었음


## 스레드 풀









